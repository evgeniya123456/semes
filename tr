import tkinter as tk
import time

class SandClock(tk.Canvas):
    def __init__(self, master, duration=60, sand_color="#FFD700", glass_color="#F0F8FF", frame_color="#8B4513", **kwargs):
        super().__init__(master, width=150, height=300, highlightthickness=0, **kwargs)
        self.duration = duration
        self.sand_color = sand_color
        self.glass_color = glass_color
        self.frame_color = frame_color
        self.sand_level = 0.0
        self.is_running = False
        self.start_time = 0
        self.timer_id = None
        self.bind("<Configure>", self._on_resize)
        self._create_sand_clock()
        self._animate_sand() 

def _calculate_coordinates(self):
        square_size = 80
        canvas_width = self.winfo_width()
        canvas_height = self.winfo_height()
        center_x = canvas_width // 2
        top_y = (canvas_height - 2 * square_size) // 2
        return center_x, top_y, square_size

    def _create_sand_clock(self):
        self.delete("all")
        cx, top_y, sq = self._calculate_coordinates()
        half_sq = sq // 2

        # Рамка пісочного годинника
        frame_points = [
            cx - half_sq, top_y,
            cx + half_sq, top_y,
            cx + 10, top_y + sq,
            cx + half_sq, top_y + 2 * sq,
            cx - half_sq, top_y + 2 * sq,
            cx - 10, top_y + sq
        ]
        self.create_polygon(frame_points, outline=self.frame_color, fill=self.glass_color, width=2, tags="glass")
# Верхній пісок
        self.upper_sand = self.create_polygon(0, 0, 0, 0, 0, 0, 0, 0, fill=self.sand_color, outline="", tags="sand")

        # Нижній пісок
        self.lower_sand = self.create_polygon(0, 0, 0, 0, 0, 0, fill=self.sand_color, outline="", tags="sand")

        # Сипучий пісок (струмінь)
        self.falling_sand = self.create_rectangle(0, 0, 0, 0, fill=self.sand_color, outline="", tags="sand")

    def _animate_sand(self):
        if self.is_running:
            elapsed = time.time() - self.start_time
            if elapsed < self.duration:
                self.sand_level = 1 - (elapsed / self.duration)  # Відлік назад
                self._update_sand_display()
                self.timer_id = self.after(50, self._animate_sand)
            else:
                self.sand_level = 0.0
                self._update_sand_display()
                self.is_running = False
                print("Час вичерпано!")
                self.flip()
